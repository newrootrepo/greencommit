<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Full Screen Color Example</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container-fluid">
        <div class="inner-container"> 
            <div class="inner-inner-container">
                <div class="input-container">
                    <h1>Sign Up</h1>
                    <form id="signup-form">
                        <div class="error-message" id="global-label"></div>
                        <label for="email" id="email-label">Email</label>
                        <input type="email" id="email" placeholder="Enter your email">
                        <label for="password" id="password-label">PassWord</label>
                        <input type="password" id="password" placeholder="Enter your password">
                        <a href="#">
                            <button class="button-signUp">Sign up with Google</button>
                        </a>
                        <button class="button-Submit">Submit</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded' , () => {
            document.addEventListener('signup-form', (event) => {
                event.preventDefault() 

                let isValid = true
                    
                //inputs
                const email = document.getElementById('email').trim().value
                const password = document.getElementById('password').trim().value

                //labels
                let emailLabel = document.getElementById('email-label')
                let passWordLabel = document.getElementById('password-label')

                //regExes
                const emailRegex = /^([a-zA-Z0-9._]+)@([a-zA-Z0-9])+\.([a-z]+)(\.[a-z]+)?$/;
                const passwordRegex = 	/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@.#$!%*?&])[A-Za-z\d@.#$!%*?&]{6,15}$/;

                if (!email) {
                    emailLabel.classList.add('error.message')
                    emailLabel.textContent = 'Email is required'
                    isValid = false
                }else if (!emailRegex.test(email)) {
                    emailError.textContent = 'Invalid Email';
                    emailError.classList.add('error-message');
                    return false;
                }
                else {
                    emailLabel.classList.remove('error.message')
                    emailLabel.textContent = 'Email'
                    isValid = true
                }

                if (!password) {
                    passwordlLabel.classList.add('error.message')
                    passwordLabel.textContent = 'Password is required'
                    isValid = false
                } else if (!passwordRegex.test(password)) {
                    passwordError.textContent = 'Password must contain at least one letter, at least one number and special character, and minimum six charaters.';
                    passwordError.classList.add('error-message');
                    return false;
                }
                else {
                    passwordlLabel.classList.remove('error.message')
                    passwordlLabel.textContent = 'Password'
                    isValid = true
                }

                if(isValid) {
                    const data = {
                        email,
                        password
                    }
                    signup(data)
                }

                function signup(email, password) {
                    fetch('/signup', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ data })
                    }).then(res => res.json())
                    .then(res => {
                        if(res.success) {
                            var notyf = new Notyf();
                            notyf.success(res.message, 1000);
                        }else {
                            let errorLabel = document.getElementById('global-label')
                            if(errorLabel) {
                                errorLabel.textContent = res.message
                            }
                        }
                    }).catch(error => {
                        let errorLabel = document.getElementById('global-label')
                        if(errorLabel) {
                            errorLabel.textContent = error.message
                        }
                    })
                }
                
            })
        })
    </script>
</body>
</html>